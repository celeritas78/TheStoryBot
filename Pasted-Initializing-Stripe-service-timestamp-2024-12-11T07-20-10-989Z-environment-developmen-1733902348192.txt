Initializing Stripe service... {
  timestamp: '2024-12-11T07:20:10.989Z',
  environment: 'development',
  apiVersion: '2024-11-20.acacia',
  hasSecretKey: true
}
Stripe service initialized successfully { timestamp: '2024-12-11T07:20:11.006Z', environment: 'development' }
Stripe API connection test successful { timestamp: '2024-12-11T07:20:12.297Z', environment: 'development' }
07:20:12 AM [express] Server initialization complete
07:20:12 AM [express] Server Details:
        Port: 5000
        Environment: development
        Node Version: v20.16.0
        Start Time: 2024-12-11T07:20:12.439Z
      

 ERROR(TypeScript)  Type '{ status: "idle"; error: null; clientSecret: null; amount: null; transactionId: null; }' is missing the following properties from type 'PaymentState': creditsToAdd, currentCredits, projectedTotalCredits
 FILE  /home/runner/CustomBedtimeStories/client/src/components/CreditPurchaseDialog.tsx:17:7

    15 | }
    16 |
  > 17 | const initialPaymentState: PaymentState = {
       |       ^^^^^^^^^^^^^^^^^^^
    18 |   status: 'idle',
    19 |   error: null,
    20 |   clientSecret: null,

 ERROR(TypeScript)  Duplicate identifier 'CREDITS_PER_USD'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:10

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |          ^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'MIN_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:27

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                           ^^^^^^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'MAX_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:49

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                                                 ^^^^^^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'STRIPE_CURRENCY'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:71

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                                                                       ^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'CREDITS_PER_USD'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:42:3

    40 | import { subscriptionService } from './services/subscription';
    41 | import { 
  > 42 |   CREDITS_PER_USD, 
       |   ^^^^^^^^^^^^^^^
    43 |   MAX_CREDITS_PURCHASE, 
    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,

 ERROR(TypeScript)  Duplicate identifier 'MAX_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:43:3

    41 | import { 
    42 |   CREDITS_PER_USD, 
  > 43 |   MAX_CREDITS_PURCHASE, 
       |   ^^^^^^^^^^^^^^^^^^^^
    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,
    46 |   STRIPE_CURRENCY,

 ERROR(TypeScript)  Duplicate identifier 'MIN_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:44:3

    42 |   CREDITS_PER_USD, 
    43 |   MAX_CREDITS_PURCHASE, 
  > 44 |   MIN_CREDITS_PURCHASE,
       |   ^^^^^^^^^^^^^^^^^^^^
    45 |   FREE_CREDITS,
    46 |   STRIPE_CURRENCY,
    47 |   STRIPE_PAYMENT_MODE,

 ERROR(TypeScript)  Duplicate identifier 'STRIPE_CURRENCY'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:46:3

    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,
  > 46 |   STRIPE_CURRENCY,
       |   ^^^^^^^^^^^^^^^
    47 |   STRIPE_PAYMENT_MODE,
    48 |   STRIPE_STATEMENT_DESCRIPTOR,
    49 |   STRIPE_STATEMENT_DESCRIPTOR_SUFFIX

 ERROR(TypeScript)  Property 'randomUUID' does not exist on type '{ hash: (password: string) => Promise<string>; compare: (suppliedPassword: string, storedPassword: string) => Promise<boolean>; generateVerificationToken: () => string; }'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:478:30

    476 |   app.post("/api/credits/purchase", async (req: Request, res: Response) => {
    477 |     const startTime = Date.now();
  > 478 |     const requestId = crypto.randomUUID(); // Add unique request ID for tracking
        |                              ^^^^^^^^^^
    479 |
    480 |     try {
    481 |       if (!req.isAuthenticated || !req.isAuthenticated()) {

 ERROR(TypeScript)  No overload matches this call.
  Overload 1 of 2, '(id: string, params?: PaymentIntentRetrieveParams | undefined, options?: RequestOptions | undefined): Promise<Response<PaymentIntent>>', gave the following error.
    Argument of type 'string | null' is not assignable to parameter of type 'string'.
      Type 'null' is not assignable to type 'string'.
  Overload 2 of 2, '(id: string, options?: RequestOptions | undefined): Promise<Response<PaymentIntent>>', gave the following error.
    Argument of type 'string | null' is not assignable to parameter of type 'string'.
      Type 'null' is not assignable to type 'string'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:532:70

    530 |           
    531 |           // Get payment intent from Stripe
  > 532 |           const paymentIntent = await stripe.paymentIntents.retrieve(transaction.stripePaymentId);
        |                                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    533 |           
    534 |           return res.json({
    535 |             clientSecret: paymentIntent.client_secret,

[TypeScript] Found 11 errors. Watching for file changes.
Login successful: { id: 35, email: 'sandeep@asterial.in' }
07:31:41 AM [express] GET /api/credits/balance 304 in 280ms :: {"credits":1,"isPremium":false}
Unhandled Rejection: {
  reason: TypeError: crypto.randomUUID is not a function
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:478:30)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:284:15
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:91:12)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:63:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:31:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at strategy.pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/middleware/authenticate.js:355:9)
      at /home/runner/CustomBedtimeStories/node_modules/passport/lib/strategies/session.js:120:12
      at pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:352:31)
      at deserialized (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:364:7)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/auth.ts:123:7)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5),
  promise: Promise {
    <rejected> TypeError: crypto.randomUUID is not a function
        at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:478:30)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:91:12)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:63:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:31:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at strategy.pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/middleware/authenticate.js:355:9)
        at /home/runner/CustomBedtimeStories/node_modules/passport/lib/strategies/session.js:120:12
        at pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:352:31)
        at deserialized (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:364:7)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/auth.ts:123:7)
        at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
  },
  timestamp: '2024-12-11T07:31:42.039Z'
}
Unhandled Rejection: {
  reason: TypeError: crypto.randomUUID is not a function
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:478:30)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:284:15
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:91:12)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:63:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:31:3)
      at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
      at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
      at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
      at strategy.pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/middleware/authenticate.js:355:9)
      at /home/runner/CustomBedtimeStories/node_modules/passport/lib/strategies/session.js:120:12
      at pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:352:31)
      at deserialized (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:364:7)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/auth.ts:123:7)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5),
  promise: Promise {
    <rejected> TypeError: crypto.randomUUID is not a function
        at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:478:30)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:91:12)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:63:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/index.ts:31:3)
        at Layer.handle [as handle_request] (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/CustomBedtimeStories/node_modules/express/lib/router/index.js:280:10)
        at strategy.pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/middleware/authenticate.js:355:9)
        at /home/runner/CustomBedtimeStories/node_modules/passport/lib/strategies/session.js:120:12
        at pass (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:352:31)
        at deserialized (/home/runner/CustomBedtimeStories/node_modules/passport/lib/authenticator.js:364:7)
        at <anonymous> (/home/runner/CustomBedtimeStories/server/auth.ts:123:7)
        at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
  },
  timestamp: '2024-12-11T07:31:42.065Z'