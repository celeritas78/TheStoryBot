> rest-express@1.0.0 dev
> tsx watch --clear-screen=false --exclude vite.config.ts.* server/index.ts

09:50:09 AM [express] serving on port 5000

[TypeScript] Found 0 errors. Watching for file changes.
Fetching all stories...
Stories fetched: 20
09:50:31 AM [express] GET /api/stories 304 in 1476ms :: [{"id":20,"title":"Sandy's Nature Adventure",…
09:50:33 AM [express] GET /api/stories/20 304 in 243ms :: {"id":20,"title":"Sandy's Nature Adventure"…
Story generation request: {
  childName: 'Rohit',
  childAge: 7,
  mainCharacter: 'Ramayan, Ram, Laxman, Sita, Hanuman, Raavan, Pushpak',
  theme: 'adventure',
  timestamp: '2024-11-29T09:50:49.746Z'
}
Generating story content with params: {
  childName: 'Rohit',
  childAge: 7,
  mainCharacter: 'Ramayan, Ram, Laxman, Sita, Hanuman, Raavan, Pushpak',
  theme: 'adventure',
  hasPreviousContent: false
}
Title section not found, generating fallback title
Successfully generated story content: {
  numberOfScenes: 3,
  preview: 'One sunny morning, Rohit and his best friend Ramayan were playing in the bright green park near thei...',
  firstSceneDescription: 'Illustrate a lush, green park filled with blooming flowers and vibrant trees under a bright blue sky...'
}
Generating image with sanitized prompt: {
  originalLength: 392,
  sanitizedLength: 392,
  promptPreview: 'Create a cheerful, child-friendly storybook illustration with the following scene: Illustrate a lush...'
}
Generating image with sanitized prompt: {
  originalLength: 423,
  sanitizedLength: 423,
  promptPreview: 'Create a cheerful, child-friendly storybook illustration with the following scene: The forest scene ...'
}
Generating image with sanitized prompt: {
  originalLength: 483,
  sanitizedLength: 483,
  promptPreview: 'Create a cheerful, child-friendly storybook illustration with the following scene: Paint the cloud c...'
}
Generating speech for text: With the map in hand, the two friends set off towards the mystic forest filled with tall, leafy tree...
Generating speech for text: One sunny morning, Rohit and his best friend Ramayan were playing in the bright green park near thei...
OpenAI Speech Generation Error: {
  error: Error: Unsupported audio format: .mp3
      at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)
      at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
      at async Promise.all (index 1)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:170:24),
  message: 'Unsupported audio format: .mp3',
  stack: 'Error: Unsupported audio format: .mp3\n' +
    '    at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)\n' +
    '    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)\n' +
    '    at async Promise.all (index 1)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:170:24)'
}
Failed to generate media for scene 2: Error: Failed to generate speech: Unsupported audio format: .mp3
    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:280:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
    at async Promise.all (index 1)
    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:170:24)
Story generation failed: {
  error: Error: Failed to generate speech: Unsupported audio format: .mp3
      at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:280:11)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
      at async Promise.all (index 1)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:170:24),
  message: 'Failed to generate speech: Unsupported audio format: .mp3',
  stack: 'Error: Failed to generate speech: Unsupported audio format: .mp3\n' +
    '    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:280:11)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)\n' +
    '    at async Promise.all (index 1)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:170:24)',
  timestamp: '2024-11-29T09:51:19.783Z'
}
09:51:19 AM [express] POST /api/stories 500 in 30038ms :: {"error":"Failed to generate story","detail…
Generating speech for text: After a long climb up rocky hills, they finally reached a magical castle made of clouds. "This must ...
OpenAI Speech Generation Error: {
  error: Error: Unsupported audio format: .mp3
      at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)
      at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
      at async Promise.all (index 0),
  message: 'Unsupported audio format: .mp3',
  stack: 'Error: Unsupported audio format: .mp3\n' +
    '    at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)\n' +
    '    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)\n' +
    '    at async Promise.all (index 0)'
}
Failed to generate media for scene 1: Error: Failed to generate speech: Unsupported audio format: .mp3
    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:280:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
    at async Promise.all (index 0)
OpenAI Speech Generation Error: {
  error: Error: Unsupported audio format: .mp3
      at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)
      at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
      at async Promise.all (index 2),
  message: 'Unsupported audio format: .mp3',
  stack: 'Error: Unsupported audio format: .mp3\n' +
    '    at saveAudioFile (/home/runner/CustomBedtimeStories/server/services/audio-storage.ts:36:11)\n' +
    '    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:270:28)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)\n' +
    '    at async Promise.all (index 2)'
}
Failed to generate media for scene 3: Error: Failed to generate speech: Unsupported audio format: .mp3
    at generateSpeech (/home/runner/CustomBedtimeStories/server/services/openai.ts:280:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:175:28)
    at async Promise.all (index 2)
