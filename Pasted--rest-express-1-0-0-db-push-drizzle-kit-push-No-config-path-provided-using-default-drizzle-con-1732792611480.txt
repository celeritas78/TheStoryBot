> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/runner/CustomBedtimeStories/drizzle.config.ts'
Using 'pg' driver for database querying
[✓] Pulling schema from database...
[i] No changes detected

> rest-express@1.0.0 dev
> tsx watch --clear-screen=false --exclude vite.config.ts.* server/index.ts

11:14:53 AM [express] serving on port 5000

 ERROR(TypeScript)  Variable 'story' implicitly has type 'any' in some locations where its type cannot be determined.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:166:11

    164 |
    165 |       // Save to database
  > 166 |       let story;
        |           ^^^^^
    167 |       try {
    168 |         console.log('Inserting story record:', {
    169 |           childName,

 ERROR(TypeScript)  Variable 'story' implicitly has an 'any' type.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:202:22

    200 |         const insertedSegments = await db.insert(storySegments)
    201 |           .values(segments.map(segment => ({
  > 202 |             storyId: story.id,
        |                      ^^^^^
    203 |             content: segment.content,
    204 |             imageUrl: segment.imageUrl,
    205 |             audioUrl: segment.audioUrl,

 ERROR(TypeScript)  Cannot find name 'newSegment'. Did you mean 'segments'?
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:226:20

    224 |       console.log('Story segment created:', {
    225 |         storyId: story.id,
  > 226 |         segmentId: newSegment.id,
        |                    ^^^^^^^^^^
    227 |         timestamp: new Date().toISOString()
    228 |       });
    229 |

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:233:33

    231 |         id: story.id,
    232 |         segments: [{
  > 233 |           content: storyContent.text,
        |                                 ^^^^
    234 |           imageUrl,
    235 |           audioUrl,
    236 |         }],

 ERROR(TypeScript)  No value exists in scope for the shorthand property 'imageUrl'. Either declare one or provide an initializer.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:234:11

    232 |         segments: [{
    233 |           content: storyContent.text,
  > 234 |           imageUrl,
        |           ^^^^^^^^
    235 |           audioUrl,
    236 |         }],
    237 |       });

 ERROR(TypeScript)  No value exists in scope for the shorthand property 'audioUrl'. Either declare one or provide an initializer.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:235:11

    233 |           content: storyContent.text,
    234 |           imageUrl,
  > 235 |           audioUrl,
        |           ^^^^^^^^
    236 |         }],
    237 |       });
    238 |     } catch (error) {

 ERROR(TypeScript)  Property 'sceneDescription' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:283:57

    281 |       });
    282 |
  > 283 |       const imageUrl = await generateImage(continuation.sceneDescription);
        |                                                         ^^^^^^^^^^^^^^^^
    284 |       const audioUrl = await generateSpeech(continuation.text);
    285 |
    286 |       // Save new segment

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:284:58

    282 |
    283 |       const imageUrl = await generateImage(continuation.sceneDescription);
  > 284 |       const audioUrl = await generateSpeech(continuation.text);
        |                                                          ^^^^
    285 |
    286 |       // Save new segment
    287 |       const segment: InsertStorySegment = {

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:289:31

    287 |       const segment: InsertStorySegment = {
    288 |         storyId: story.id,
  > 289 |         content: continuation.text,
        |                               ^^^^
    290 |         imageUrl,
    291 |         audioUrl,
    292 |         sequence: (segments?.length ?? 0) + 1,

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:298:31

    296 |
    297 |       res.json({
  > 298 |         content: continuation.text,
        |                               ^^^^
    299 |         imageUrl,
    300 |         audioUrl,
    301 |       });

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/services/openai.ts:109:33

    107 |
    108 |     console.log('Successfully generated story content:', { 
  > 109 |       textLength: parsedContent.text.length,
        |                                 ^^^^
    110 |       sceneDescriptionLength: parsedContent.sceneDescription.length,
    111 |       preview: parsedContent.text.substring(0, 100) + '...'
    112 |     });

 ERROR(TypeScript)  Property 'sceneDescription' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/services/openai.ts:110:45

    108 |     console.log('Successfully generated story content:', { 
    109 |       textLength: parsedContent.text.length,
  > 110 |       sceneDescriptionLength: parsedContent.sceneDescription.length,
        |                                             ^^^^^^^^^^^^^^^^
    111 |       preview: parsedContent.text.substring(0, 100) + '...'
    112 |     });
    113 |     

 ERROR(TypeScript)  Property 'text' does not exist on type 'StoryContent'.
 FILE  /home/runner/CustomBedtimeStories/server/services/openai.ts:111:30

    109 |       textLength: parsedContent.text.length,
    110 |       sceneDescriptionLength: parsedContent.sceneDescription.length,
  > 111 |       preview: parsedContent.text.substring(0, 100) + '...'
        |                              ^^^^
    112 |     });
    113 |     
    114 |     return parsedContent;

[TypeScript] Found 13 errors. Watching for file changes.
Fetching all stories...
Stories fetched: 11
11:15:30 AM [express] GET /api/stories 304 in 1473ms :: [{"id":11,"childName":"joe","childAge":6,"cha…
Story generation request: {
  childName: 'Reva',
  childAge: 7,
  mainCharacter: 'fruits, garden, bees, friends',
  theme: 'nature',
  timestamp: '2024-11-28T11:15:53.145Z'
}
Starting story generation process with params: {
  childName: 'Reva',
  childAge: 7,
  mainCharacter: 'fruits, garden, bees, friends',
  theme: 'nature'
}
Generating story content with params: {
  childName: 'Reva',
  childAge: 7,
  mainCharacter: 'fruits, garden, bees, friends',
  theme: 'nature',
  hasPreviousContent: false
}
Error in story content generation: {
  error: TypeError: Cannot read properties of undefined (reading 'length')
      at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:109:38)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:118:24),
  message: "Cannot read properties of undefined (reading 'length')",
  stack: "TypeError: Cannot read properties of undefined (reading 'length')\n" +
    '    at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:109:38)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:118:24)'
}
Story generation failed: Error: Failed to generate story content: Cannot read properties of undefined (reading 'length')
    at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:121:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:118:24)
11:16:06 AM [express] POST /api/stories 500 in 13314ms :: {"error":"Failed to generate story content"…
