> rest-express@1.0.0 dev
> tsx watch --clear-screen=false --exclude vite.config.ts.* server/index.ts

08:37:41 AM [express] serving on port 5000

[TypeScript] Found 0 errors. Watching for file changes.
Fetching all stories...
Stories fetched: 19
08:38:06 AM [express] GET /api/stories 304 in 1486ms :: [{"id":19,"title":"greg's Adventure Adventure…
08:38:08 AM [express] GET /api/stories/19 200 in 236ms :: {"id":19,"title":"greg's Adventure Adventur…
Story generation request: {
  childName: 'prem',
  childAge: 6,
  mainCharacter: 'foreign trip, europe, friends',
  theme: 'friendship',
  timestamp: '2024-11-29T08:38:42.096Z'
}
Generating story content with params: {
  childName: 'prem',
  childAge: 6,
  mainCharacter: 'foreign trip, europe, friends',
  theme: 'friendship',
  hasPreviousContent: false
}
Sending request to OpenAI with prompt: {
  systemPrompt: "You are a skilled children's story writer. Create engaging, age-appropriate content with the followi...",
  userPrompt: "Create an engaging children's story about prem (age 6) and their friend foreign trip, europe, friend..."
}
Received raw response from OpenAI: {
  id: 'chatcmpl-AYqoNUyM0373uaFeAHeETsodGfA6O',
  model: 'gpt-4o-mini-2024-07-18',
  usage: {
    prompt_tokens: 313,
    completion_tokens: 783,
    total_tokens: 1096,
    prompt_tokens_details: { cached_tokens: 0, audio_tokens: 0 },
    completion_tokens_details: {
      reasoning_tokens: 0,
      audio_tokens: 0,
      accepted_prediction_tokens: 0,
      rejected_prediction_tokens: 0
    }
  },
  choices: 1
}
Raw content from OpenAI: **THE GREAT EUROPEAN ADVENTURE**

[STORY]

[Scene 1]  
One sunny morning, Prem and his best friend, Mia, were sitting in Prem's treehouse. [excited] "I had a DREAM, Mia!" Prem exclaimed, his eyes sparkling with joy. "We went to Europe!"  
Mia's eyes widened, "Oh my! Like, to France and Italy? Imagine the cheese and pizza!"  
Prem nodded vigorously, "Yes! And we can see the Eiffel Tower! Let’s make a plan!"  

They grabbed some colorful crayons and began drawing a map of their imaginary European trip. [happy] "We’ll travel by airplane, see the pyramids in Egypt, and ride gondolas in Venice!" shouted Mia.  


[Scene 1 Description]  
The illustration shows a bright, cheerful treehouse with lots of colorful decorations. Prem and Mia are both sitting on the floor, surrounded by crayons and paper, depicting a lively scene of creativity. The treehouse is filled with sunlight, and outside, the leaves are green and fluttering in a gentle breeze. Prem is drawing a big Eiffel Tower while Mia adds a pizza slice to their map. Both characters exude excitement and friendship, with big smiles on their faces.

[Scene 2]  
That afternoon, they decided to pretend they were on their adventure. [playful] "Welcome to France, my friend!" Prem declared as he put on a funny beret.  
Mia giggled and held up a toy baguette, waving it like a flag. “Ooh la la! Look at me! I’m a fancy French chef!”  
Suddenly, Prem noticed the garden behind the treehouse. “Let’s have a picnic, just like in Europe!” [excited]  
They raced down to the garden and spread out a blanket, filling it with their favorite snacks—sandwiches, apple slices, and some gummy bears. Once settled, Prem sighed happily, “This is the best adventure ever!”  

[Scene 2 Description]  
This scene captures Prem and Mia in the garden, laying on a bright and colorful picnic blanket. The sun is shining down, and the trees around them are lush and green. The scene is filled with delicious snacks—sandwiches neatly arranged, apple slices gleaming in the light, and bright gummy bears spilling out of a small bowl. The expressions of joy and imagination on their faces emphasize their friendship and the fun they are having pretending to be in Europe.

[Scene 3]  
As the sun began to set, painting the sky in shades of orange and purple, Prem and Mia returned to the treehouse. [reflective] “You know, Mia,” Prem said quietly, “it feels like we traveled really far together today.”  
Mia nodded, her smile gentle. “We didn’t need to go anywhere. Just having fun with you makes me feel like I’m already in Europe.”  
With a warm hug, they agreed that no trip could ever be as special as their friendship. “Next time, let’s travel to a different country in our dreams!” [excited] Prem proposed. “How about Japan?”  
“YES! With sushi and cherry blossoms!” Mia cheered, and they both laughed, dreaming of their next great adventure.  

[Scene 3 Description]  
The final scene reflects the beautiful sunset in the sky, casting soft, warm colors in the treehouse. Prem and Mia are sitting close together, wrapped in hugs, with the remnants of their picnic around them. Their little books and crayons are nearby, hinting at future adventures. Both characters look content and happy, embodying the warmth of friendship. The outside view shows the colorful sky, transitioning from bright sunset hues to a starry night, symbolizing the joy and possibilities of their dreams ahead.
Title section not found, generating fallback title
Failed to parse story sections: {
  hasStorySection: true,
  hasDescriptionsSection: false,
  content: '**THE GREAT EUROPEAN ADVENTURE**\n' +
    '\n' +
    '[STORY]\n' +
    '\n' +
    '[Scene 1]  \n' +
    `One sunny morning, Prem and his best friend, Mia, were sitting in Prem's treehouse. [excited] "I had a DREAM, Mia!" Prem exclaimed, his eyes sparkling with joy. "We went to Europe!"  \n` +
    `Mia's eyes widened, "Oh my! Like, to France and Italy? Imagine the cheese and pizza!"  \n` +
    'Prem nodded vigorously, "Yes! And we can see the Eiffel Tower! Let’s make a plan!"  \n' +
    '\n' +
    'They grabbed some colorful crayons and began drawing a map of their imaginary European trip. [happy] "We’ll travel by airplane, see the pyramids in Egypt, and ride gondolas in Venice!" shouted Mia.  \n' +
    '\n' +
    '\n' +
    '[Scene 1 Description]  \n' +
    'The illustration shows a bright, cheerful treehouse with lots of colorful decorations. Prem and Mia are both sitting on the floor, surrounded by crayons and paper, depicting a lively scene of creativity. The treehouse is filled with sunlight, and outside, the leaves are green and fluttering in a gentle breeze. Prem is drawing a big Eiffel Tower while Mia adds a pizza slice to their map. Both characters exude excitement and friendship, with big smiles on their faces.\n' +
    '\n' +
    '[Scene 2]  \n' +
    'That afternoon, they decided to pretend they were on their adventure. [playful] "Welcome to France, my friend!" Prem declared as he put on a funny beret.  \n' +
    'Mia giggled and held up a toy baguette, waving it like a flag. “Ooh la la! Look at me! I’m a fancy French chef!”  \n' +
    'Suddenly, Prem noticed the garden behind the treehouse. “Let’s have a picnic, just like in Europe!” [excited]  \n' +
    'They raced down to the garden and spread out a blanket, filling it with their favorite snacks—sandwiches, apple slices, and some gummy bears. Once settled, Prem sighed happily, “This is the best adventure ever!”  \n' +
    '\n' +
    '[Scene 2 Description]  \n' +
    'This scene captures Prem and Mia in the garden, laying on a bright and colorful picnic blanket. The sun is shining down, and the trees around them are lush and green. The scene is filled with delicious snacks—sandwiches neatly arranged, apple slices gleaming in the light, and bright gummy bears spilling out of a small bowl. The expressions of joy and imagination on their faces emphasize their friendship and the fun they are having pretending to be in Europe.\n' +
    '\n' +
    '[Scene 3]  \n' +
    'As the sun began to set, painting the sky in shades of orange and purple, Prem and Mia returned to the treehouse. [reflective] “You know, Mia,” Prem said quietly, “it feels like we traveled really far together today.”  \n' +
    'Mia nodded, her smile gentle. “We didn’t need to go anywhere. Just having fun with you makes me feel like I’m already in Europe.”  \n' +
    'With a warm hug, they agreed that no trip could ever be as special as their friendship. “Next time, let’s travel to a different country in our dreams!” [excited] Prem proposed. “How about Japan?”  \n' +
    '“YES! With sushi and cherry blossoms!” Mia cheered, and they both laughed, dreaming of their next great adventure.  \n' +
    '\n' +
    '[Scene 3 Description]  \n' +
    'The final scene reflects the beautiful sunset in the sky, casting soft, warm colors in the treehouse. Prem and Mia are sitting close together, wrapped in hugs, with the remnants of their picnic around them. Their little books and crayons are nearby, hinting at future adventures. Both characters look content and happy, embodying the warmth of friendship. The outside view shows the colorful sky, transitioning from bright sunset hues to a starry night, symbolizing the joy and possibilities of their dreams ahead.'
}
Error in story content generation: {
  error: Error: Story generation failed: Invalid content structure
      at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:135:13)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:123:28),
  message: 'Story generation failed: Invalid content structure',
  stack: 'Error: Story generation failed: Invalid content structure\n' +
    '    at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:135:13)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:123:28)'
}
Story generation failed: {
  error: Error: Failed to generate story content: Story generation failed: Invalid content structure
      at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:206:11)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:123:28),
  message: 'Failed to generate story content: Story generation failed: Invalid content structure',
  stack: 'Error: Failed to generate story content: Story generation failed: Invalid content structure\n' +
    '    at generateStoryContent (/home/runner/CustomBedtimeStories/server/services/openai.ts:206:11)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:123:28)',
  timestamp: '2024-11-29T08:38:50.703Z'
}
08:38:50 AM [express] POST /api/stories 500 in 8607ms :: {"error":"Failed to generate story","details…