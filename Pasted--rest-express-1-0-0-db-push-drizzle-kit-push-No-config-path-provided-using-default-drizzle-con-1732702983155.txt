> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/runner/CustomBedtimeStories/drizzle.config.ts'
Using 'pg' driver for database querying
[âœ“] Pulling schema from database...
[i] No changes detected

> rest-express@1.0.0 dev
> tsx watch --clear-screen=false --exclude vite.config.ts.* server/index.ts

10:19:11 AM [express] serving on port 5000

 ERROR(TypeScript)  'audioRef.current.readyState' is possibly 'undefined'.
 FILE  /home/runner/CustomBedtimeStories/client/src/components/AudioPlayer.tsx:148:52

    146 |   }
    147 |
  > 148 |   if (isLoading || (!audioRef.current?.duration && audioRef.current?.readyState < 4)) {
        |                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    149 |     return (
    150 |       <div className="flex items-center justify-center p-4 text-gray-500">
    151 |         <Loader2 className="h-4 w-4 animate-spin mr-2" />

 ERROR(TypeScript)  Expected 0 arguments, but got 1.
 FILE  /home/runner/CustomBedtimeStories/db/schema.ts:7:32

     5 |
     6 | export const favorites = pgTable("favorites", {
  >  7 |   id: integer("id").primaryKey({ autoIncrement: true }),
       |                                ^^^^^^^^^^^^^^^^^^^^^^^
     8 |   storyId: integer("story_id").references(() => stories.id),
     9 |   createdAt: timestamp("created_at").defaultNow(),
    10 | });

 ERROR(TypeScript)  Expected 0 arguments, but got 1.
 FILE  /home/runner/CustomBedtimeStories/db/schema.ts:13:32

    11 |
    12 | export const stories = pgTable("stories", {
  > 13 |   id: integer("id").primaryKey({ autoIncrement: true }),
       |                                ^^^^^^^^^^^^^^^^^^^^^^^
    14 |   childName: text("child_name").notNull(),
    15 |   childAge: integer("child_age").notNull(),
    16 |   characters: jsonb("characters").notNull(),

 ERROR(TypeScript)  Expected 0 arguments, but got 1.
 FILE  /home/runner/CustomBedtimeStories/db/schema.ts:25:32

    23 |
    24 | export const storySegments = pgTable("story_segments", {
  > 25 |   id: integer("id").primaryKey({ autoIncrement: true }),
       |                                ^^^^^^^^^^^^^^^^^^^^^^^
    26 |   storyId: integer("story_id")
    27 |     .notNull()
    28 |     .references(() => stories.id, { onDelete: 'cascade' }),

 ERROR(TypeScript)  No overload matches this call.
  Overload 1 of 2, '(value: { id: number | SQL<unknown> | Placeholder<string, any>; content: string | SQL<unknown> | Placeholder<string, any>; childName: string | SQL<unknown> | Placeholder<...>; ... 5 more ...; createdAt?: Date | ... 3 more ... | undefined; }): PgInsertBase<...>', gave the following error.
    Argument of type '{ childName: any; childAge: number; characters: string; theme: any; content: string; imageUrls: string; }' is not assignable to parameter of type '{ id: number | SQL<unknown> | Placeholder<string, any>; content: string | SQL<unknown> | Placeholder<string, any>; childName: string | SQL<unknown> | Placeholder<...>; ... 5 more ...; createdAt?: Date | ... 3 more ... | undefined; }'.
      Property 'id' is missing in type '{ childName: any; childAge: number; characters: string; theme: any; content: string; imageUrls: string; }' but required in type '{ id: number | SQL<unknown> | Placeholder<string, any>; content: string | SQL<unknown> | Placeholder<string, any>; childName: string | SQL<unknown> | Placeholder<...>; ... 5 more ...; createdAt?: Date | ... 3 more ... | undefined; }'.
  Overload 2 of 2, '(values: { id: number | SQL<unknown> | Placeholder<string, any>; content: string | SQL<unknown> | Placeholder<string, any>; childName: string | SQL<unknown> | Placeholder<...>; ... 5 more ...; createdAt?: Date | ... 3 more ... | undefined; }[]): PgInsertBase<...>', gave the following error.
    Object literal may only specify known properties, and 'childName' does not exist in type '{ id: number | SQL<unknown> | Placeholder<string, any>; content: string | SQL<unknown> | Placeholder<string, any>; childName: string | SQL<unknown> | Placeholder<...>; ... 5 more ...; createdAt?: Date | ... 3 more ... | undefined; }[]'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:174:12

    172 |
    173 |       const [result] = await db.insert(stories)
  > 174 |           .values({
        |            ^^^^^^
    175 |             childName,
    176 |             childAge: parsedAge,
    177 |             characters: JSON.stringify({ mainCharacter }),

 ERROR(TypeScript)  Property 'id' is missing in type '{ storyId: number; content: string; imageUrl: string; audioUrl: string; sequence: number; }' but required in type '{ id: number; content: string; audioUrl: string; storyId: number; imageUrl: string; sequence: number; createdAt?: Date | null | undefined; }'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:205:13

    203 |
    204 |       // Add the first story segment
  > 205 |       const segment: InsertStorySegment = {
        |             ^^^^^^^
    206 |         storyId: story.id,
    207 |         content: storyContent.text,
    208 |         imageUrl,

 ERROR(TypeScript)  Property 'id' is missing in type '{ storyId: number; content: string; imageUrl: string; audioUrl: string; sequence: number; }' but required in type '{ id: number; content: string; audioUrl: string; storyId: number; imageUrl: string; sequence: number; createdAt?: Date | null | undefined; }'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:279:13

    277 |
    278 |       // Save new segment
  > 279 |       const segment: InsertStorySegment = {
        |             ^^^^^^^
    280 |         storyId: story.id,
    281 |         content: continuation.text,
    282 |         imageUrl,

 ERROR(TypeScript)  No overload matches this call.
  Overload 1 of 2, '(value: { id: number | SQL<unknown> | Placeholder<string, any>; createdAt?: Date | SQL<unknown> | Placeholder<string, any> | null | undefined; storyId?: number | ... 3 more ... | undefined; }): PgInsertBase<...>', gave the following error.
    Argument of type '{ storyId: number; }' is not assignable to parameter of type '{ id: number | SQL<unknown> | Placeholder<string, any>; createdAt?: Date | SQL<unknown> | Placeholder<string, any> | null | undefined; storyId?: number | SQL<...> | Placeholder<...> | null | undefined; }'.
      Property 'id' is missing in type '{ storyId: number; }' but required in type '{ id: number | SQL<unknown> | Placeholder<string, any>; createdAt?: Date | SQL<unknown> | Placeholder<string, any> | null | undefined; storyId?: number | SQL<...> | Placeholder<...> | null | undefined; }'.
  Overload 2 of 2, '(values: { id: number | SQL<unknown> | Placeholder<string, any>; createdAt?: Date | SQL<unknown> | Placeholder<string, any> | null | undefined; storyId?: number | ... 3 more ... | undefined; }[]): PgInsertBase<...>', gave the following error.
    Object literal may only specify known properties, and 'storyId' does not exist in type '{ id: number | SQL<unknown> | Placeholder<string, any>; createdAt?: Date | SQL<unknown> | Placeholder<string, any> | null | undefined; storyId?: number | SQL<...> | Placeholder<...> | null | undefined; }[]'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:333:10

    331 |       const [favorite] = await db
    332 |         .insert(favorites)
  > 333 |         .values({ storyId: parseInt(storyId) })
        |          ^^^^^^
    334 |         .returning();
    335 |       res.json(favorite);
    336 |     } catch (error) {

[TypeScript] Found 8 errors. Watching for file changes.
Fetching favorites...
Favorites fetched: []
10:19:45 AM [express] GET /api/favorites 304 in 986ms :: []
Story generation request: {
  childName: 'deepo',
  childAge: 4,
  mainCharacter: 'spectacle, horse, mountain trail, tiger',
  theme: 'adventure',
  timestamp: '2024-11-27T10:21:26.331Z'
}
Starting story generation process with params: {
  childName: 'deepo',
  childAge: 4,
  mainCharacter: 'spectacle, horse, mountain trail, tiger',
  theme: 'adventure'
}
Generating story content with params: {
  childName: 'deepo',
  childAge: 4,
  mainCharacter: 'spectacle, horse, mountain trail, tiger',
  theme: 'adventure',
  hasPreviousContent: false
}
Successfully generated story content: {
  textLength: 1204,
  sceneDescriptionLength: 170,
  preview: '[Story Text]\n' +
    '\n' +
    'Once upon a time, in a peaceful village lived an adventurous four-year-old named Deepo...'
}
Successfully generated story content: { contentLength: 1204, sceneDescriptionLength: 170 }
Generating image with sanitized prompt: {
  originalLength: 170,
  sanitizedLength: 168,
  promptPreview: 'Create a cheerful, child-friendly storybook illustration with the following scene: Deepo and Spectac...'
}
Generated image URL: https://oaidalleapiprodscus.blob.core.windows.net/private/org-8hqUrMQvREaIO7bDZXZNpDR1/user-RcpYfzRbtZ5ra2JTLyVdShGs/img-bi3fI6GA9hU4agxobhBQpKVU.png?st=2024-11-27T09%3A22%3A02Z&se=2024-11-27T11%3A22%3A02Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2024-11-27T00%3A51%3A22Z&ske=2024-11-28T00%3A51%3A22Z&sks=b&skv=2024-08-04&sig=3yIJWUvhk4XfauaVjqGdpmYxS1yKgNjoZD9GYFb0G5w%3D
Generating speech for text: [Story Text]

Once upon a time, in a peaceful village lived an adventurous four-year-old named Deepo...
Successfully saved audio file: /audio/181ac572-a50d-445f-82ed-7947ac1ec1bc.mp3
Generated audio URL: /audio/181ac572-a50d-445f-82ed-7947ac1ec1bc.mp3
Inserting story record: {
  childName: 'deepo',
  childAge: 4,
  theme: 'adventure',
  timestamp: '2024-11-27T10:22:13.754Z'
}
Database operation failed: {
  error: error: null value in column "id" of relation "stories" violates not-null constraint
      at file:///home/runner/CustomBedtimeStories/node_modules/@neondatabase/serverless/index.mjs:1345:74
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at NeonPreparedQuery.execute (/home/runner/CustomBedtimeStories/node_modules/src/neon-serverless/session.ts:102:18)
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:173:24) {
    length: 449,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (null, deepo, 4, "{\\"mainCharacter\\":\\"spectacle, horse, mountain trail, tiger\\"}..., adventure, [Story Text]\n' +
      '\n' +
      'Once upon a time, in a peaceful village lived an a..., "[\\"https://oaidalleapiprodscus.blob.core.windows.net/private/or..., f, 2024-11-27 10:22:14.599371).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'stories',
    column: 'id',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '2011',
    routine: 'ExecConstraints'
  },
  message: 'null value in column "id" of relation "stories" violates not-null constraint'
}
Story generation failed: {
  error: Error: Failed to save story to database
      at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:201:15)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5),
  message: 'Failed to save story to database',
  stack: 'Error: Failed to save story to database\n' +
    '    at <anonymous> (/home/runner/CustomBedtimeStories/server/routes.ts:201:15)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)',
  timestamp: '2024-11-27T10:22:14.727Z'
}
10:22:14 AM [express] POST /api/stories 500 in 48398ms :: {"error":"Failed to generate story","detailâ€¦