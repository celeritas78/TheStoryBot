Initializing Stripe service... {
  timestamp: '2024-12-11T07:33:13.222Z',
  environment: 'development',
  apiVersion: '2024-11-20.acacia',
  hasSecretKey: true
}
Stripe service initialized successfully { timestamp: '2024-12-11T07:33:13.248Z', environment: 'development' }
Stripe API connection test successful { timestamp: '2024-12-11T07:33:14.128Z', environment: 'development' }
07:33:14 AM [express] Server initialization complete
07:33:14 AM [express] Server Details:
        Port: 5000
        Environment: development
        Node Version: v20.16.0
        Start Time: 2024-12-11T07:33:14.205Z
      

 ERROR(TypeScript)  Type '{ status: "idle"; error: null; clientSecret: null; amount: null; transactionId: null; }' is missing the following properties from type 'PaymentState': creditsToAdd, currentCredits, projectedTotalCredits
 FILE  /home/runner/CustomBedtimeStories/client/src/components/CreditPurchaseDialog.tsx:17:7

    15 | }
    16 |
  > 17 | const initialPaymentState: PaymentState = {
       |       ^^^^^^^^^^^^^^^^^^^
    18 |   status: 'idle',
    19 |   error: null,
    20 |   clientSecret: null,

 ERROR(TypeScript)  Duplicate identifier 'CREDITS_PER_USD'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:10

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |          ^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'MIN_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:27

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                           ^^^^^^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'MAX_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:49

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                                                 ^^^^^^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'STRIPE_CURRENCY'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:6:71

    4 | import { eq, sql, and, desc } from 'drizzle-orm';
    5 | import { crypto } from './auth';
  > 6 | import { CREDITS_PER_USD, MIN_CREDITS_PURCHASE, MAX_CREDITS_PURCHASE, STRIPE_CURRENCY } from './config';
      |                                                                       ^^^^^^^^^^^^^^^
    7 | import { z } from 'zod';
    8 | import { db } from '../db';
    9 | import { stories, storySegments, users, creditTransactions } from '../db/schema';

 ERROR(TypeScript)  Duplicate identifier 'CREDITS_PER_USD'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:42:3

    40 | import { subscriptionService } from './services/subscription';
    41 | import { 
  > 42 |   CREDITS_PER_USD, 
       |   ^^^^^^^^^^^^^^^
    43 |   MAX_CREDITS_PURCHASE, 
    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,

 ERROR(TypeScript)  Duplicate identifier 'MAX_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:43:3

    41 | import { 
    42 |   CREDITS_PER_USD, 
  > 43 |   MAX_CREDITS_PURCHASE, 
       |   ^^^^^^^^^^^^^^^^^^^^
    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,
    46 |   STRIPE_CURRENCY,

 ERROR(TypeScript)  Duplicate identifier 'MIN_CREDITS_PURCHASE'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:44:3

    42 |   CREDITS_PER_USD, 
    43 |   MAX_CREDITS_PURCHASE, 
  > 44 |   MIN_CREDITS_PURCHASE,
       |   ^^^^^^^^^^^^^^^^^^^^
    45 |   FREE_CREDITS,
    46 |   STRIPE_CURRENCY,
    47 |   STRIPE_PAYMENT_MODE,

 ERROR(TypeScript)  Duplicate identifier 'STRIPE_CURRENCY'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:46:3

    44 |   MIN_CREDITS_PURCHASE,
    45 |   FREE_CREDITS,
  > 46 |   STRIPE_CURRENCY,
       |   ^^^^^^^^^^^^^^^
    47 |   STRIPE_PAYMENT_MODE,
    48 |   STRIPE_STATEMENT_DESCRIPTOR,
    49 |   STRIPE_STATEMENT_DESCRIPTOR_SUFFIX

 ERROR(TypeScript)  No overload matches this call.
  Overload 1 of 2, '(id: string, params?: PaymentIntentRetrieveParams | undefined, options?: RequestOptions | undefined): Promise<Response<PaymentIntent>>', gave the following error.
    Argument of type 'string | null' is not assignable to parameter of type 'string'.
      Type 'null' is not assignable to type 'string'.
  Overload 2 of 2, '(id: string, options?: RequestOptions | undefined): Promise<Response<PaymentIntent>>', gave the following error.
    Argument of type 'string | null' is not assignable to parameter of type 'string'.
      Type 'null' is not assignable to type 'string'.
 FILE  /home/runner/CustomBedtimeStories/server/routes.ts:532:70

    530 |           
    531 |           // Get payment intent from Stripe
  > 532 |           const paymentIntent = await stripe.paymentIntents.retrieve(transaction.stripePaymentId);
        |                                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    533 |           
    534 |           return res.json({
    535 |             clientSecret: paymentIntent.client_secret,

[TypeScript] Found 10 errors. Watching for file changes.
Login successful: { id: 35, email: 'sandeep@asterial.in' }
07:33:51 AM [express] GET /api/credits/balance 304 in 283ms :: {"credits":1,"isPremium":false}
Credit purchase request: {
  requestId: '2e539bca4bc1969f95cb63234e182f0ddf7798ad0bfa916c87f9d10aca6a06c3',
  userId: 35,
  userEmail: 'sandeep@asterial.in',
  currentCredits: 1,
  isPremium: false,
  requestedAmount: 10,
  timestamp: '2024-12-11T07:33:53.857Z'
}
Credit purchase request: {
  requestId: 'a951017baa4cc2ebd09a08a565ac04a95e1b9c473e3365ae0bde05263ebfe56d',
  userId: 35,
  userEmail: 'sandeep@asterial.in',
  currentCredits: 1,
  isPremium: false,
  requestedAmount: 10,
  timestamp: '2024-12-11T07:33:53.882Z'
}
Creating payment intent: {
  amount: 10,
  userId: 35,
  amountInCents: 1000,
  creditsToAdd: 10,
  timestamp: '2024-12-11T07:33:54.099Z',
  environment: 'development',
  stripeMode: 'payment'
}
Creating payment intent: {
  amount: 10,
  userId: 35,
  amountInCents: 1000,
  creditsToAdd: 10,
  timestamp: '2024-12-11T07:33:54.119Z',
  environment: 'development',
  stripeMode: 'payment'
}
Payment intent created: {
  paymentIntentId: 'pi_3QUkQgSBc9gulaWv0ZwsqkO3',
  amount: 1000,
  credits: 10,
  status: 'requires_payment_method',
  timestamp: '2024-12-11T07:33:54.553Z'
}
Stripe payment intent created: {
  requestId: '2e539bca4bc1969f95cb63234e182f0ddf7798ad0bfa916c87f9d10aca6a06c3',
  userId: 35,
  amount: 10,
  creditsToAdd: 10,
  paymentIntentId: 'pi_3QUkQgSBc9gulaWv0ZwsqkO3',
  status: 'requires_payment_method',
  timestamp: '2024-12-11T07:33:54.554Z'
}
Payment intent created: {
  paymentIntentId: 'pi_3QUkQgSBc9gulaWv1vh5YgRJ',
  amount: 1000,
  credits: 10,
  status: 'requires_payment_method',
  timestamp: '2024-12-11T07:33:54.583Z'
}
Stripe payment intent created: {
  requestId: 'a951017baa4cc2ebd09a08a565ac04a95e1b9c473e3365ae0bde05263ebfe56d',
  userId: 35,
  amount: 10,
  creditsToAdd: 10,
  paymentIntentId: 'pi_3QUkQgSBc9gulaWv1vh5YgRJ',
  status: 'requires_payment_method',
  timestamp: '2024-12-11T07:33:54.583Z'
}
Credit transaction created: {
  requestId: '2e539bca4bc1969f95cb63234e182f0ddf7798ad0bfa916c87f9d10aca6a06c3',
  userId: 35,
  transactionId: 15,
  amount: 1000,
  creditsToAdd: 10,
  projectedTotalCredits: 11,
  status: 'pending',
  duration: '1559ms',
  timestamp: '2024-12-11T07:33:54.844Z'
}
Credit transaction created: {
  requestId: 'a951017baa4cc2ebd09a08a565ac04a95e1b9c473e3365ae0bde05263ebfe56d',
  userId: 35,
  transactionId: 16,
  amount: 1000,
  creditsToAdd: 10,
  projectedTotalCredits: 11,
  status: 'pending',
  duration: '1545ms',
  timestamp: '2024-12-11T07:33:54.868Z'
}
07:33:55 AM [express] POST /api/credits/purchase 200 in 1801ms :: {"clientSecret":"pi_3QUkQgSBc9gulaW…
07:33:55 AM [express] POST /api/credits/purchase 200 in 1786ms :: {"clientSecret":"pi_3QUkQgSBc9gulaW…
